<!DOCTYPE html>

<html lang="en">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Construction 21</title>

Â  Â  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNlMGExMDYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTUuMDUgNWEzIDMgMCAwIDEgNC41IDBIM15NMTUuMDUgNU0xOSA4LjVjMCAxLjUtLjUgMy41LTIgNC41di4wNUgxN2EyIDIgMCAwIDAgLTIgLTIgYSAyIDIgMCAwIDAgLTIgMkgxM3YtNkgxNlY4LjVNOSA2LjVWNE02IDcgTDUuNSAxNC41TWwwIDE1IDguOTkgMy04IGMxLjUgLTRoMmMwIDAuNSAwLjUgMSAwLjUgMnYxSDEwdjNjMCAxIDAgMi40IC0xIDN2XzIgYzAgMC41IDAuMiAwLjUgMC41IDAuNXMwLjUgLTAuMiAwLjUgLTAuNVYyMUg0LjA3bDEuOCAtMTQuMjUgYTEgMSAwIDAgMSAwLjE5IC0wLjA3IHoiLz48L3N2Zz4=" type="image/svg+xml">

Â  Â  <!--

Â  Â  NOTE: For production, you should install Tailwind CSS properly:

Â  Â  1. Use npm: npm install tailwindcss postcss autoprefixer

Â  Â  2. Initialize: npx tailwindcss init

Â  Â  3. Configure tailwind.config.js and postcss.config.js

Â  Â  4. Use the CLI to build a production CSS file: npx tailwindcss -i ./src/input.css -o ./dist/output.css

Â  Â 

Â  Â  See https://tailwindcss.com/docs/installation for detailed instructions

Â  Â  This CDN version is fine for development but not recommended for production.

Â  Â  -->

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <style>

Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  margin: 0;

Â  Â  Â  Â  Â  Â  padding: 0;

Â  Â  Â  Â  Â  Â  background: radial-gradient(ellipse at 60% 40%, #ffd70033 0%, #23232b 100%), linear-gradient(135deg, #23232b 0%, #2d2d3a 100%);

Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Arial, sans-serif;

Â  Â  Â  Â  Â  Â  min-height: 100vh;

Â  Â  Â  Â  Â  Â  color: #EAEAEA;

Â  Â  Â  Â  }

Â  Â  Â  Â  .animated-bg {

Â  Â  Â  Â  Â  Â  position: fixed; inset: 0; z-index: -1; pointer-events: none; overflow: hidden;

Â  Â  Â  Â  }

Â  Â  Â  Â  .bg-shape {

Â  Â  Â  Â  Â  Â  position: absolute; border-radius: 50%; opacity: 0.18; filter: blur(18px); animation: floatBg 8s ease-in-out infinite alternate;

Â  Â  Â  Â  }

Â  Â  Â  Â  .bg-shape1 { width: 340px; height: 340px; background: #ffd700; left: 8vw; top: 10vh; animation-delay: 0s; }

Â  Â  Â  Â  .bg-shape2 { width: 220px; height: 220px; background: #ff4e00; right: 10vw; top: 30vh; animation-delay: 2s; }

Â  Â  Â  Â  .bg-shape3 { width: 180px; height: 180px; background: #00cfff; left: 30vw; bottom: 8vh; animation-delay: 4s; }

Â  Â  Â  Â  @keyframes floatBg {

Â  Â  Â  Â  Â  Â  0% { transform: translateY(0) scale(1); }

Â  Â  Â  Â  Â  Â  100% { transform: translateY(-25px) scale(1.05); }

Â  Â  Â  Â  }

Â  Â  Â  Â  #game-container {

Â  Â  Â  Â  Â  Â  width: 100%; max-width: 800px; margin: 0 auto; padding: 20px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .card-table {

Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; gap: 30px; padding: 20px;

Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #05392d 0%, #083f2e 100%);

Â  Â  Â  Â  Â  Â  border-radius: 15px;

Â  Â  Â  Â  Â  Â  box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.3), 0 10px 30px rgba(0, 0, 0, 0.5);

Â  Â  Â  Â  Â  Â  border: 6px solid #05392d;

Â  Â  Â  Â  }

Â  Â  Â  Â  .dealer-area, .player-area {

Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center;

Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.15); padding: 20px; border-radius: 12px;

Â  Â  Â  Â  Â  Â  box-shadow: inset 0 0 15px rgba(0,0,0,0.2);

Â  Â  Â  Â  }

Â  Â  Â  Â  .hand-label {

Â  Â  Â  Â  Â  Â  color: white; font-size: 18px; margin-bottom: 12px; font-weight: bold;

Â  Â  Â  Â  Â  Â  text-shadow: 0 2px 4px rgba(0,0,0,0.3); background: rgba(255,215,0,0.15);

Â  Â  Â  Â  Â  Â  padding: 5px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);

Â  Â  Â  Â  }

Â  Â  Â  Â  .cards {

Â  Â  Â  Â  Â  Â  display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; min-height: 180px; align-items: center; padding: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .card {

Â  Â  Â  Â  Â  Â  width: 120px; height: 170px; background: white; border-radius: 12px;

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.25); position: relative;

Â  Â  Â  Â  Â  Â  transform-style: preserve-3d;

Â  Â  Â  Â  Â  Â  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);

Â  Â  Â  Â  }

Â  Â  Â  Â  .card.hidden {

Â  Â  Â  Â  Â  Â  transform: rotateY(180deg);

Â  Â  Â  Â  }

Â  Â  Â  Â  .card .card-face, .card .card-back {

Â  Â  Â  Â  Â  Â  position: absolute; width: 100%; height: 100%;

Â  Â  Â  Â  Â  Â  backface-visibility: hidden; -webkit-backface-visibility: hidden;

Â  Â  Â  Â  Â  Â  border-radius: 12px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .card .card-face {

Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; justify-content: space-between;

Â  Â  Â  Â  Â  Â  box-sizing: border-box; padding: 10px; background: white;

Â  Â  Â  Â  Â  Â  border: 1px solid #e0e0e0;

Â  Â  Â  Â  }

Â  Â  Â  Â  .card.red .card-face { color: #e63946; }

Â  Â  Â  Â  .card.black .card-face { color: #1d3557; }

Â  Â  Â  Â  .card .card-back {

Â  Â  Â  Â  Â  Â  background: repeating-linear-gradient(135deg, #0a4d68, #0a4d68 10px, #088395 10px, #088395 20px);

Â  Â  Â  Â  Â  Â  transform: rotateY(180deg); display: flex; align-items: center; justify-content: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .card .card-back::after { content: "ğŸ”¨"; font-size: 50px; color: rgba(255, 255, 255, 0.85); text-shadow: 0 0 5px rgba(0, 0, 0, 0.3); }

Â  Â  Â  Â  .card .corner { display: flex; flex-direction: column; align-items: center; font-weight: bold; line-height: 1; }

Â  Â  Â  Â  .card .top-left { align-self: flex-start; }

Â  Â  Â  Â  .card .bottom-right { align-self: flex-end; transform: rotate(180deg); }

Â  Â  Â  Â  .card .value { font-size: 22px; }

Â  Â  Â  Â  .card .suit { font-size: 24px; }

Â  Â  Â  Â  .card .center-suit, .card .face-design { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

Â  Â  Â  Â  .card .center-suit { font-size: 60px; }

Â  Â  Â  Â  .card .face-design { font-size: 48px; }

Â  Â  Â  Â  .card .face-K::after { content: 'ğŸ‘·â€â™‚ï¸'; }

Â  Â  Â  Â  .card .face-Q::after { content: 'ğŸ‘·â€â™€ï¸'; }

Â  Â  Â  Â  .card .face-J::after { content: 'ğŸ—ï¸'; }

Â  Â  Â  Â  .card .face-A { font-size: 72px; }

Â  Â  Â  Â  @keyframes dealCard {

Â  Â  Â  Â  Â  Â  from { transform: translateY(-300px) translateX(400px) rotate(180deg) scale(0.3); opacity: 0; }

Â  Â  Â  Â  Â  Â  to { transform: translateY(0) translateX(0) rotate(0deg) scale(1); opacity: 1; }

Â  Â  Â  Â  }

Â  Â  Â  Â  .card.dealing { animation: dealCard 0.5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards; }

Â  Â  Â  Â  .control-btn, .auth-btn, .primary-btn, .secondary-btn {

Â  Â  Â  Â  Â  Â  padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: bold;

Â  Â  Â  Â  Â  Â  cursor: pointer; transition: all 0.2s; border: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  .control-btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.6; }

Â  Â  Â  Â  .chip {

Â  Â  Â  Â  Â  Â  width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;

Â  Â  Â  Â  Â  Â  font-weight: bold; font-size: 18px; color: white; margin: 5px; cursor: pointer;

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.3); position: relative; text-shadow: 0 1px 2px rgba(0,0,0,0.5);

Â  Â  Â  Â  Â  Â  border: 2px solid rgba(255,255,255,0.3); transition: transform 0.15s, box-shadow 0.15s;

Â  Â  Â  Â  }

Â  Â  Â  Â  .chip:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.4); }

Â  Â  Â  Â  .chip-5 { background: linear-gradient(135deg, #f55 0%, #900 100%); }

Â  Â  Â  Â  .chip-10 { background: linear-gradient(135deg, #55f 0%, #006 100%); }

Â  Â  Â  Â  .chip-25 { background: linear-gradient(135deg, #5f5 0%, #060 100%); }

Â  Â  Â  Â  .chip-100 { background: linear-gradient(135deg, #000 0%, #333 100%); }

Â  Â  Â  Â  #game-result-screen {

Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;

Â  Â  Â  Â  Â  Â  background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(5px);

Â  Â  Â  Â  Â  Â  z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center;

Â  Â  Â  Â  Â  Â  gap: 1.5rem; opacity: 0; pointer-events: none; transition: opacity 0.4s;

Â  Â  Â  Â  Â  Â  border-radius: 15px;

Â  Â  Â  Â  }

Â  Â  Â  Â  #game-result-screen.active { opacity: 1; pointer-events: all; }

Â  Â  Â  Â  #leaderboard {

Â  Â  Â  Â  Â  Â  Â background: rgba(17, 24, 39, 0.8);

Â  Â  Â  Â  Â  Â  Â backdrop-filter: blur(5px);

Â  Â  Â  Â  Â  Â  Â border: 1px solid rgba(255,255,255,0.1);

Â  Â  Â  Â  }

Â  Â  Â  Â  .auth-tab-content { display: none; }

Â  Â  Â  Â  .auth-tab-content.active { display: block; }

Â  Â  Â  Â  .auth-tab-btn.active { background-color: #4f46e5; color: white; }

Â  Â  </style>

</head>

<body class="bg-gray-900 text-white">

Â  Â  <div class="animated-bg">

Â  Â  Â  Â  <div class="bg-shape bg-shape1"></div>

Â  Â  Â  Â  <div class="bg-shape bg-shape2"></div>

Â  Â  Â  Â  <div class="bg-shape bg-shape3"></div>

Â  Â  </div>



Â  Â  <div id="game-container" class="p-4 mx-auto max-w-4xl">

Â  Â  Â  Â  <h1 class="text-4xl font-bold text-center text-yellow-400 mb-4">ğŸ”¨ Construction 21 ğŸ”¨</h1>



Â  Â  Â  Â  <!-- Main Menu -->

Â  Â  Â  Â  <div id="main-menu" class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">

Â  Â  Â  Â  Â  Â  <div id="auth-section">

Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- Auth content will be injected by JS -->

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="user-profile" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl mb-2">Welcome, <span id="profile-name" class="font-bold text-yellow-400"></span>!</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-lg mb-4">Your Chips: <span id="profile-chips" class="font-bold"></span></div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="play-btn" class="primary-btn bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto">Play Game</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="logout-btn" class="secondary-btn bg-gray-600 hover:bg-gray-700 text-white w-full sm:w-auto mt-2 sm:mt-0 sm:ml-2">Logout</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>



Â  Â  Â  Â  <!-- Game Canvas -->

Â  Â  Â  Â  <div id="game-canvas" class="hidden mt-4">

Â  Â  Â  Â  Â  Â  <div class="card-table">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="dealer-area">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hand-label">Dealer's Hand: <span id="dealer-score">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="dealer-cards" class="cards"></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-area">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hand-label">Your Hand: <span id="player-score">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-hands-display" class="cards"></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  <div id="betting-controls" class="mt-4 space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold">Place Your Bets</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="bet-amount" class="text-sm">Main Bet:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="bet-amount" value="10" min="1" class="p-1 border rounded w-20 text-black">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">Current: <span id="current-bet">0</span></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Side Bet Inputs -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="perfect-pairs-bet" class="text-sm">Perfect Pairs:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="perfect-pairs-bet" value="0" min="0" class="p-1 border rounded w-20 text-black">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">Current: <span id="current-pp-bet">0</span></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="twenty-one-plus-three-bet" class="text-sm">21+3:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="twenty-one-plus-three-bet" value="0" min="0" class="p-1 border rounded w-20 text-black">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">Current: <span id="current-21plus3-bet">0</span></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="place-bet-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Place Bet</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <div id="game-area" class="hidden mt-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold">Dealer\'s Hand</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="dealer-score" class="text-lg">Score: 0</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="dealer-cards" class="flex space-x-2 mt-2 min-h-[100px]">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Dealer cards will be added here -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mt-4">Your Hand(s)</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Placeholder for side bet results -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="side-bet-results" class="hidden my-2 p-2 border rounded bg-blue-100 text-blue-800">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Side bet results will be shown here -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Container for multiple player hands -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-hands-display" class="mt-2 space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Player hands will be dynamically created here by JS -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Example structure for a single hand (to be replicated by JS):

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-hand border p-2 rounded">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-score text-lg">Score: 0</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-cards flex space-x-2 mt-2 min-h-[100px]">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Player cards

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hand-status text-sm italic"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="game-controls" class="mt-4 space-x-2 hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="hit-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Hit</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="stand-btn" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">Stand</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="split-btn" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded hidden">Split</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Double Down button will be added here later -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <!-- Result Screen -->

Â  Â  Â  Â  Â  Â  <div id="game-result-screen">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="result-message" class="text-4xl font-bold text-yellow-400">You Win!</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-2xl">Final Chips: <span id="final-chips" class="font-bold">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="play-again-btn" class="primary-btn bg-blue-600 hover:bg-blue-700 text-white">Play Again</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="return-menu-btn" class="secondary-btn bg-gray-600 hover:bg-gray-700 text-white ml-2">Main Menu</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â 

Â  Â  Â  Â  <!-- Leaderboard -->

Â  Â  Â  Â  <div id="leaderboard" class="mt-6 p-4 rounded-lg shadow-lg hidden">

Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-center mb-4 text-yellow-400">Top Players</h2>

Â  Â  Â  Â  Â  Â  <ul id="leaderboard-entries" class="space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  <!-- Entries populated by JS -->

Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <script type="module">

Â  Â  Â  Â  // Firebase Imports - Using latest modular SDK

Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

Â  Â  Â  Â  import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, getDocs, limit, orderBy as firestoreOrderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â 

Â  Â  Â  Â  // --- DOM Elements ---

Â  Â  Â  Â  const mainMenu = document.getElementById('main-menu');

Â  Â  Â  Â  const gameCanvas = document.getElementById('game-canvas');

Â  Â  Â  Â  const leaderboardDiv = document.getElementById('leaderboard');

Â  Â  Â  Â  const authSection = document.getElementById('auth-section');

Â  Â  Â  Â  const userProfile = document.getElementById('user-profile');

Â  Â  Â  Â  const dealerCardsEl = document.getElementById('dealer-cards');

Â  Â  Â  Â  const playerCardsEl = document.getElementById('player-cards');

Â  Â  Â  Â  const dealerScoreEl = document.getElementById('dealer-score');

Â  Â  Â  Â  const playerScoreEl = document.getElementById('player-score');

Â  Â  Â  Â  const bettingControls = document.getElementById('betting-controls');

Â  Â  Â  Â  const gameControls = document.getElementById('game-controls');

Â  Â  Â  Â  const gameResultScreen = document.getElementById('game-result-screen');

Â  Â  Â  Â  // New element references for split and side bets Â  Â  Â  Â const playerHandsDisplay = document.getElementById('player-hands-display'); // JS will need this

Â  Â  Â  Â  const sideBetResultsEl = document.getElementById('side-bet-results'); // JS will need this

Â  Â  Â  Â  let splitButton = document.getElementById('split-btn'); // JS will need this - using 'let' to allow reassignment

Â  Â  Â  Â  // References for side bet input fields (assuming JS will use these IDs)

Â  Â  Â  Â  const perfectPairsBetInput = document.getElementById('perfect-pairs-bet');

Â  Â  Â  Â  const twentyOnePlusThreeBetInput = document.getElementById('twenty-one-plus-three-bet');

Â  Â  Â  Â  const currentPPBetDisplay = document.getElementById('current-pp-bet');

Â  Â  Â  Â  const current21Plus3BetDisplay = document.getElementById('current-21plus3-bet');





Â  Â  Â  Â  // --- Game State ---

Â  Â  Â  Â  let db, auth;

Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

Â  Â  Â  Â  let currentUser = null;

Â  Â  Â  Â  let currentPlayerName = "Guest";

Â  Â  Â  Â  let deck = [];

Â  Â  Â  Â  let dealerHand = [];

Â  Â  Â  Â  let playerHand = []; // This will likely be replaced by playerHands for multi-hand support

Â  Â  Â  Â  let playerHands = []; // To support multiple hands after splitting

Â  Â  Â  Â  let activeHandIndex = 0; // To track the currently played hand



Â  Â  Â  Â  let playerChips = 100;

Â  Â  Â  Â  let currentBet = 0;

Â  Â  Â  Â  // Add state for side bets

Â  Â  Â  Â  let perfectPairsBetAmount = 0;

Â  Â  Â  Â  let twentyOnePlusThreeBetAmount = 0;



Â  Â  Â  Â  const suits = ['â™¥', 'â™¦', 'â™ ', 'â™£'];

Â  Â  Â  Â  const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];



Â  Â  Â  Â  // --- Helper Functions ---

Â  Â  Â  Â  const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));



Â  Â  Â  Â  // --- Hashing Utilities ---

Â  Â  Â  Â  const SALT_LENGTH = 16; // Length of the salt in bytes



Â  Â  Â  Â  function generateSalt() {

Â  Â  Â  Â  Â  Â  const arr = new Uint8Array(SALT_LENGTH);

Â  Â  Â  Â  Â  Â  crypto.getRandomValues(arr);

Â  Â  Â  Â  Â  Â  // Convert byte array to hex string

Â  Â  Â  Â  Â  Â  return Array.from(arr).map(b => b.toString(16).padStart(2, '0')).join('');

Â  Â  Â  Â  }



Â  Â  Â  Â  async function hashPassword(password, salt) {

Â  Â  Â  Â  Â  Â  const encoder = new TextEncoder();

Â  Â  Â  Â  Â  Â  // Combine password and salt before hashing

Â  Â  Â  Â  Â  Â  const data = encoder.encode(password + salt);

Â  Â  Â  Â  Â  Â  const hashBuffer = await crypto.subtle.digest('SHA-256', data);

Â  Â  Â  Â  Â  Â  // Convert ArrayBuffer to hex string

Â  Â  Â  Â  Â  Â  const hashArray = Array.from(new Uint8Array(hashBuffer));

Â  Â  Â  Â  Â  Â  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- Firebase Initialization and Auth ---

Â  Â  Â  Â  function initializeFirebase() {

Â  Â  Â  Â  Â  Â  // Use __firebase_config global variable provided by the environment

Â  Â  Â  Â  Â  Â  let firebaseConfig = {};

Â  Â  Â  Â  Â  Â  if (typeof __firebase_config !== 'undefined' && __firebase_config) {

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  firebaseConfig = JSON.parse(__firebase_config);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error parsing __firebase_config. Make sure it's a valid JSON string. Falling back to placeholder.", e);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (authSection) authSection.innerHTML = `<p class="text-red-500 text-center">Error: Firebase configuration is invalid. Please check the console.</p>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (!firebaseConfig.apiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  firebaseConfig = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyBVtq6dAEuybJNmTTv8dXBxTVUgw1t0ZMk",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  authDomain: "cusumano-website.firebaseapp.com",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  databaseURL: "https://cusumano-website-default-rtdb.firebaseio.com",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  projectId: "cusumano-website",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  storageBucket: "cusumano-website.firebasestorage.app",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messagingSenderId: "20051552210",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appId: "1:20051552210:web:7eb3b22baa3fec184e4a0b"

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  // No warning message here as we are now hardcoding it as a fallback.

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase apiKey is missing or is a placeholder. Firebase will not initialize.");

Â  Â  Â  Â  Â  Â  Â  Â  if (authSection) authSection.innerHTML = `<p class="text-red-500 text-center">Error: Firebase API key is missing. Please configure Firebase correctly.</p>`;

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);

Â  Â  Â  Â  Â  Â  auth = getAuth(app);

Â  Â  Â  Â  Â  Â  db = getFirestore(app);



Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, async (firebaseUser) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (firebaseUser) { // A Firebase user is signed in

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (firebaseUser.isAnonymous) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentUser && (currentUser.isCustomAuth || currentUser.isLocalGuest)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Firebase anonymous user event, but a custom/local session is active. Ignoring Firebase anonymous user.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Optional: consider signing out the unexpected anonymous user if this state is problematic

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // signOut(auth).catch(e => console.warn("Failed to sign out stowaway anonymous user", e));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // No active custom/local session, so proceed with Firebase anonymous user

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Firebase Anonymous user signed in. Setting up session.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firebaseUserData = await getUserDataFromFirebase(firebaseUser.uid);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: firebaseUser.uid,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayName: firebaseUserData.displayName || "Guest (Firebase)",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnonymous: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isCustomAuth: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLocalGuest: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chips: firebaseUserData.chips !== undefined ? firebaseUserData.chips : 100

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayerName = currentUser.displayName;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerChips = currentUser.chips;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showUserProfile(); // This will also call fetchLeaderboard

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // A non-anonymous Firebase user signed in (e.g., Email/Password, Google etc.)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("A non-anonymous Firebase user signed in, which is not expected by the current custom auth flow.", firebaseUser);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentUser && currentUser.isCustomAuth) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Non-anonymous Firebase user detected, but custom user session is active. Prioritizing custom session.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If no custom session, this is an unexpected state.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // For now, this app doesn't handle this case beyond logging.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else { // No Firebase user is signed in (firebaseUser is null)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentUser && (currentUser.isCustomAuth || currentUser.isLocalGuest)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // A custom or local guest session is active. Firebase being signed out doesn't affect them.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No Firebase user, but a custom/local session is active. Maintaining current session.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // No Firebase user AND no active custom/local session.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No Firebase user and no active custom/local session. Clearing any residual session and showing auth forms.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayerName = "Guest";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerChips = 100; // Reset game state for new user/guest

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showAuthForms(); // This will also call fetchLeaderboard if user proceeds to login/guest play that shows profile

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Explicitly clear and then try to fetch leaderboard for the initial auth screen state

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (leaderboardDiv) leaderboardDiv.innerHTML = ''; // Clear previous leaderboard

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchLeaderboard(); // Attempt to show leaderboard even on auth screen

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  // Initial check, if no user, show auth forms (onAuthStateChanged will handle this)

Â  Â  Â  Â  Â  Â  // Call fetchLeaderboard once on initial load if db is available

Â  Â  Â  Â  Â  Â  if (db) {

Â  Â  Â  Â  Â  Â  Â  Â  fetchLeaderboard();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  async function getUserDataFromFirebase(userId) {

Â  Â  Â  Â  Â  Â  const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/data`, 'profile');

Â  Â  Â  Â  Â  Â  const userDoc = await getDoc(userDocRef);

Â  Â  Â  Â  Â  Â  if (userDoc.exists()) {

Â  Â  Â  Â  Â  Â  Â  Â  return userDoc.data();

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  const newUser = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayName: "Guest (Anonymous)",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chips: 100,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: new Date().toISOString(),

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  // Only set for Firebase anonymous users if they don't have a profile yet

Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(userDocRef, newUser, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  return newUser;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  async function fetchLeaderboard() {

Â  Â  Â  Â  Â  Â  if (!db) {

Â  Â  Â  Â  Â  Â  Â  Â  console.warn('Firestore not initialized yet. Skipping leaderboard fetch.');

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const leaderboardEl = document.getElementById('leaderboard');

Â  Â  Â  Â  Â  Â  Â  Â  const entriesEl = document.getElementById('leaderboard-entries');

Â  Â  Â  Â  Â  Â  Â  Â  if (!leaderboardEl || !entriesEl) return;



Â  Â  Â  Â  Â  Â  Â  Â  // Show leaderboard section

Â  Â  Â  Â  Â  Â  Â  Â  leaderboardEl.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  entriesEl.innerHTML = '<li class="text-center text-gray-400">Loading leaderboard...</li>';



Â  Â  Â  Â  Â  Â  Â  Â  // Get top players from Firestore

Â  Â  Â  Â  Â  Â  Â  Â  const leaderboardRef = collection(db, 'game_users_custom_auth');

Â  Â  Â  Â  Â  Â  Â  Â  const q = query(leaderboardRef, firestoreOrderBy('chips', 'desc'), limit(10));

Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (querySnapshot.empty) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entriesEl.innerHTML = '<li class="text-center text-gray-400">No players found.</li>';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  // Build leaderboard entries

Â  Â  Â  Â  Â  Â  Â  Â  entriesEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  let rank = 1;

Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userData = doc.data();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const displayName = userData.displayName || 'Anonymous';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chips = userData.chips || 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const entryItem = document.createElement('li');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entryItem.className = 'flex justify-between items-center p-2 border-b border-gray-700';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entryItem.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-medium">${rank}. ${displayName}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-yellow-400">${chips} chips</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entriesEl.appendChild(entryItem);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rank++;

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching leaderboard:', error);

Â  Â  Â  Â  Â  Â  Â  Â  const entriesEl = document.getElementById('leaderboard-entries');

Â  Â  Â  Â  Â  Â  Â  Â  if (entriesEl) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entriesEl.innerHTML = '<li class="text-center text-red-400">Failed to load leaderboard.</li>';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  async function getCustomUserData(userId) {

Â  Â  Â  Â  Â  Â  const userDocRef = doc(db, 'game_users_custom_auth', userId);

Â  Â  Â  Â  Â  Â  const userDoc = await getDoc(userDocRef);

Â  Â  Â  Â  Â  Â  if (userDoc.exists()) {

Â  Â  Â  Â  Â  Â  Â  Â  return { id: userDoc.id, ...userDoc.data() };

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  }



Â  Â  Â  Â  function showUserProfile() {

Â  Â  Â  Â  Â  Â  authSection.innerHTML = ''; // Clear auth forms

Â  Â  Â  Â  Â  Â  authSection.classList.add('hidden');

Â  Â  Â  Â  Â  Â  userProfile.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  const profileNameEl = document.getElementById('profile-name');

Â  Â  Â  Â  Â  Â  const profileChipsEl = document.getElementById('profile-chips');

Â  Â  Â  Â  Â  Â  if (profileNameEl) profileNameEl.textContent = currentPlayerName;

Â  Â  Â  Â  Â  Â  if (profileChipsEl) profileChipsEl.textContent = playerChips;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  fetchLeaderboard(); // Fetch and display leaderboard when user profile is shown

Â  Â  Â  Â  }



Â  Â  Â  Â  /**

Â  Â  Â  Â  Â * Authentication UI with tabs for Login, Sign Up, and Guest play.

Â  Â  Â  Â  Â */

Â  Â  Â  Â  function showAuthForms() {

Â  Â  Â  Â  Â  Â  userProfile.classList.add('hidden');

Â  Â  Â  Â  Â  Â  authSection.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  // Reset game state if returning to auth forms from a game

Â  Â  Â  Â  Â  Â  resetGameStateToDefault();

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  authSection.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-b border-gray-600 mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav class="-mb-px flex space-x-4" aria-label="Tabs">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="login" class="auth-tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-400">Login</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="signup" class="auth-tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500">Sign Up</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-tab="guest" class="auth-tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500">Play as Guest</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </nav>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <!-- Login Form -->

Â  Â  Â  Â  Â  Â  Â  Â  <div id="login-tab" class="auth-tab-content active text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="login-username" class="block text-sm font-medium text-gray-300">Username</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="login-username" autocomplete="username" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Your username">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="login-password" class="block text-sm font-medium text-gray-300">Password</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="login-password" autocomplete="current-password" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Your password">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="login-btn" class="w-full auth-btn bg-indigo-600 hover:bg-indigo-700 text-white">Login</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="login-message" class="text-sm text-red-400 h-4"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <!-- Sign Up Form -->

Â  Â  Â  Â  Â  Â  Â  Â  <div id="signup-tab" class="auth-tab-content text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="signup-name" class="block text-sm font-medium text-gray-300">Display Name</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="signup-name" autocomplete="nickname" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="How you'll appear to others">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="signup-username" class="block text-sm font-medium text-gray-300">Username (for login)</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="signup-username" autocomplete="username" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Choose a username">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="signup-password" class="block text-sm font-medium text-gray-300">Password</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="signup-password" autocomplete="new-password" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="6+ characters">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="signup-btn" class="w-full auth-btn bg-indigo-600 hover:bg-indigo-700 text-white">Create Account</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p id="signup-message" class="text-sm text-red-400 h-4"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  <!-- Guest Form -->

Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="guest-tab" class="auth-tab-content text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-gray-400 mb-4">Play without an account. Your progress will be temporary.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="guest-play-btn" class="w-full auth-btn bg-green-600 hover:bg-green-700 text-white">Play as Guest</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p id="guest-message" class="text-sm text-red-400 h-4 mt-2"></p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Add event listeners for the new auth UI

Â  Â  Â  Â  Â  Â  const tabs = authSection.querySelectorAll('.auth-tab-btn');

Â  Â  Â  Â  Â  Â  const contents = authSection.querySelectorAll('.auth-tab-content');



Â  Â  Â  Â  Â  Â  tabs.forEach(tab => {

Â  Â  Â  Â  Â  Â  Â  Â  tab.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tabs.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.remove('border-indigo-500', 'text-indigo-400');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.add('border-transparent', 'text-gray-400', 'hover:text-gray-200', 'hover:border-gray-500');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tab.classList.add('border-indigo-500', 'text-indigo-400');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tab.classList.remove('border-transparent', 'text-gray-400', 'hover:text-gray-200', 'hover:border-gray-500');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contents.forEach(content => content.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  document.getElementById('login-btn').addEventListener('click', async () => {

Â  Â  Â  Â  Â  Â  Â  Â  const username = document.getElementById('login-username').value;

Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('login-password').value;

Â  Â  Â  Â  Â  Â  Â  Â  const messageEl = document.getElementById('login-message');

Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = ''; // Clear previous messages



Â  Â  Â  Â  Â  Â  Â  Â  if (!username || !password) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = "Please enter username and password.";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = 'Logging in...';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await handleCustomLogin(username, password);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // On success, handleCustomLogin should update state and call showUserProfile()

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Custom login failed:", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = error.message || "Login failed. Please check your credentials.";

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  document.getElementById('signup-btn').addEventListener('click', async () => {

Â  Â  Â  Â  Â  Â  Â  Â  const displayName = document.getElementById('signup-name').value;

Â  Â  Â  Â  Â  Â  Â  Â  const username = document.getElementById('signup-username').value;

Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('signup-password').value;

Â  Â  Â  Â  Â  Â  Â  Â  const messageEl = document.getElementById('signup-message');

Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = ''; // Clear previous messages



Â  Â  Â  Â  Â  Â  Â  Â  if (!displayName || !username || !password) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = "Please fill out all fields.";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (password.length < 6) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = "Password should be at least 6 characters.";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = 'Creating account...';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await handleCustomSignUp(username, password, displayName);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // On success, handleCustomSignUp should update state and call showUserProfile()

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Custom sign up failed:", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = error.message || "Sign up failed. Username might be taken or an error occurred.";

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  document.getElementById('guest-play-btn').addEventListener('click', async () => {

Â  Â  Â  Â  Â  Â  Â  Â  const messageEl = document.getElementById('guest-message');

Â  Â  Â  Â  Â  Â  Â  Â  if (messageEl) messageEl.textContent = '';



Â  Â  Â  Â  Â  Â  Â  Â  console.log("Starting local guest mode.");

Â  Â  Â  Â  Â  Â  Â  Â  currentUser = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: 'local_guest_' + Date.now(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayName: 'Guest (Local Demo)',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLocalGuest: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnonymous: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isCustomAuth: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chips: 100

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  currentPlayerName = currentUser.displayName;

Â  Â  Â  Â  Â  Â  Â  Â  playerChips = currentUser.chips; // Initialize playerChips for guest

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  showUserProfile();

Â  Â  Â  Â  Â  Â  Â  Â  if (messageEl) messageEl.textContent = "Playing as Guest (Demo Mode). Progress is not saved.";

Â  Â  Â  Â  Â  Â  Â  Â  // fetchLeaderboard(); // showUserProfile calls this already

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- Game Logic ---

Â  Â  Â  Â  function resetGameStateToDefault() {

Â  Â  Â  Â  Â  Â  deck = [];

Â  Â  Â  Â  Â  Â  dealerHand = [];

Â  Â  Â  Â  Â  Â  playerHands = [];

Â  Â  Â  Â  Â  Â  activeHandIndex = 0;

Â  Â  Â  Â  Â  Â  currentBet = 0;

Â  Â  Â  Â  Â  Â  perfectPairsBetAmount = 0;

Â  Â  Â  Â  Â  Â  twentyOnePlusThreeBetAmount = 0;

Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  if (dealerCardsEl) dealerCardsEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (playerHandsDisplay) playerHandsDisplay.innerHTML = ''; // Clear multi-hand display

Â  Â  Â  Â  Â  Â  if (sideBetResultsEl) {

Â  Â  Â  Â  Â  Â  Â  Â  sideBetResultsEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  sideBetResultsEl.classList.add('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Hide game controls, result screen, show betting (or main menu if applicable)

Â  Â  Â  Â  Â  Â  if (gameControls) gameControls.classList.add('hidden');

Â  Â  Â  Â  Â  Â  if (bettingControls) bettingControls.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  if (gameResultScreen) gameResultScreen.classList.remove('active');



Â  Â  Â  Â  Â  Â  const chipsDisplay = document.getElementById('player-chips');

Â  Â  Â  Â  Â  Â  if (chipsDisplay) chipsDisplay.textContent = playerChips;

Â  Â  Â  Â  Â  Â  const currentBetDisplay = document.getElementById('current-bet');

Â  Â  Â  Â  Â  Â  if (currentBetDisplay) currentBetDisplay.textContent = currentBet;

Â  Â  Â  Â  Â  Â  // Reset side bet displays

Â  Â  Â  Â  Â  Â  if (currentPPBetDisplay) currentPPBetDisplay.textContent = '0';

Â  Â  Â  Â  Â  Â  if (perfectPairsBetInput) perfectPairsBetInput.value = '0';

Â  Â  Â  Â  Â  Â  if (current21Plus3BetDisplay) current21Plus3BetDisplay.textContent = '0';

Â  Â  Â  Â  Â  Â  if (twentyOnePlusThreeBetInput) twentyOnePlusThreeBetInput.value = '0';

Â  Â  Â  Â  Â  Â  if (splitButton) splitButton.classList.add('hidden');

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  async function startNewHand() {

Â  Â  Â  Â  Â  Â  toggleControls(false);

Â  Â  Â  Â  Â  Â  if (currentBet === 0) { // Main bet must be placed

Â  Â  Â  Â  Â  Â  Â  Â  alert("Please place a main bet first.");

Â  Â  Â  Â  Â  Â  Â  Â  toggleControls(false);

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  playerHands = [{

Â  Â  Â  Â  Â  Â  Â  Â  cards: [], bet: currentBet, score: 0, isStood: false, isBust: false,

Â  Â  Â  Â  Â  Â  Â  Â  isBlackjack: false, canSplit: false, id: "hand-0", element: null,

Â  Â  Â  Â  Â  Â  Â  Â  scoreElement: null, statusElement: null, resultMessage: "", payout: 0,

Â  Â  Â  Â  Â  Â  Â  Â  isAceSplit: false // For handling Ace split rules

Â  Â  Â  Â  Â  Â  }];

Â  Â  Â  Â  Â  Â  activeHandIndex = 0;

Â  Â  Â  Â  Â  Â  dealerHand = [];

Â  Â  Â  Â  Â  Â  if (dealerCardsEl) dealerCardsEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  playerHandsDisplay.innerHTML = ''; // Clear for new hand(s)

Â  Â  Â  Â  Â  Â  if (sideBetResultsEl) {

Â  Â  Â  Â  Â  Â  Â  Â  sideBetResultsEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  sideBetResultsEl.classList.add('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  createDeck();



Â  Â  Â  Â  Â  Â  // Create and initialize the first hand display

Â  Â  Â  Â  Â  Â  createPlayerHandDisplay(playerHands[activeHandIndex]);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Deal cards to player and dealer with animation

Â  Â  Â  Â  Â  Â  await dealCardToPlayer(playerHands[activeHandIndex]); // First card to player

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  await dealCardToDealer(false); // First card to dealer (face up)

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  await dealCardToPlayer(playerHands[activeHandIndex]); // Second card to player

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  await dealCardToDealer(true); // Second card to dealer (face down)

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Evaluate side bets if applicable

Â  Â  Â  Â  Â  Â  if (perfectPairsBetAmount > 0 || twentyOnePlusThreeBetAmount > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  evaluateSideBets();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Update scores and UI, check for split option

Â  Â  Â  Â  Â  Â  updateScoresAndUI();

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Show game controls

Â  Â  Â  Â  Â  Â  toggleControls(true);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Check for blackjack in the initial hand

Â  Â  Â  Â  Â  Â  const currentActiveHand = playerHands[activeHandIndex];

Â  Â  Â  Â  Â  Â  if (currentActiveHand.score === 21 && currentActiveHand.cards.length === 2) {

Â  Â  Â  Â  Â  Â  Â  Â  currentActiveHand.isBlackjack = true;

Â  Â  Â  Â  Â  Â  Â  Â  currentActiveHand.statusElement.textContent = "Blackjack!";

Â  Â  Â  Â  Â  Â  Â  Â  currentActiveHand.statusElement.classList.add("text-green-400", "font-bold");

Â  Â  Â  Â  Â  Â  Â  Â  await sleep(1000);

Â  Â  Â  Â  Â  Â  Â  Â  stand(); // Move to dealer's turn

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  // Constants for side bet payouts

Â  Â  Â  Â  const PERFECT_PAIRS_PAYOUTS = {

Â  Â  Â  Â  Â  Â  perfect: 25, // Same suit, same rank (e.g., â™¥K â™¥K)

Â  Â  Â  Â  Â  Â  colored: 12, // Same color, same rank (e.g., â™¥K â™¦K)

Â  Â  Â  Â  Â  Â  mixed: 6 Â  Â  // Different color, same rank (e.g., â™¥K â™ K)

Â  Â  Â  Â  };

Â  Â  Â  Â 

Â  Â  Â  Â  const TWENTY_ONE_PLUS_THREE_PAYOUTS = {

Â  Â  Â  Â  Â  Â  suitedTrips: 100, Â // Three of a kind, same suit (e.g., â™¥A â™¥A â™¥A)

Â  Â  Â  Â  Â  Â  straightFlush: 40, // Three consecutive cards, same suit

Â  Â  Â  Â  Â  Â  threeOfAKind: 30, Â // Three of a kind, mixed suits

Â  Â  Â  Â  Â  Â  straight: 10, Â  Â  Â // Three consecutive cards, mixed suits

Â  Â  Â  Â  Â  Â  flush: 5 Â  Â  Â  Â  Â  // Three cards of the same suit

Â  Â  Â  Â  };

Â  Â  Â  Â 

Â  Â  Â  Â  function createDeck() {

Â  Â  Â  Â  Â  Â  deck = [];

Â  Â  Â  Â  Â  Â  for (const suit of suits) {

Â  Â  Â  Â  Â  Â  Â  Â  for (const value of values) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deck.push({ suit, value });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Shuffle the deck

Â  Â  Â  Â  Â  Â  for (let i = deck.length - 1; i > 0; i--) {

Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));

Â  Â  Â  Â  Â  Â  Â  Â  [deck[i], deck[j]] = [deck[j], deck[i]];

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  function calculateScore(hand) {

Â  Â  Â  Â  Â  Â  let score = 0;

Â  Â  Â  Â  Â  Â  let aceCount = 0;

Â  Â  Â  Â  Â  Â  hand.forEach(card => {

Â  Â  Â  Â  Â  Â  Â  Â  if (card.value === 'A') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aceCount++;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score += 11; // Initially count Ace as 11

Â  Â  Â  Â  Â  Â  Â  Â  } else if (['K', 'Q', 'J'].includes(card.value)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score += 10;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score += parseInt(card.value);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Adjust for Aces if score is over 21

Â  Â  Â  Â  Â  Â  while (score > 21 && aceCount > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  score -= 10;

Â  Â  Â  Â  Â  Â  Â  Â  aceCount--;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return score;

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  function updateScoresAndUI() {

Â  Â  Â  Â  Â  Â  playerHands.forEach((hand, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  hand.score = calculateScore(hand.cards);

Â  Â  Â  Â  Â  Â  Â  Â  const handScoreEl = document.getElementById(`player-score`);

Â  Â  Â  Â  Â  Â  Â  Â  if (handScoreEl) handScoreEl.textContent = hand.score;

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  dealerHand.score = calculateScore(dealerHand.cards);

Â  Â  Â  Â  Â  Â  if (dealerScoreEl) dealerScoreEl.textContent = dealerHand.score;

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  function createPlayerHandDisplay(hand) {

Â  Â  Â  Â  Â  Â  const handContainer = document.createElement('div');

Â  Â  Â  Â  Â  Â  handContainer.className = 'player-hand border p-2 rounded';

Â  Â  Â  Â  Â  Â  handContainer.id = hand.id;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  const handTitle = document.createElement('div');

Â  Â  Â  Â  Â  Â  handTitle.className = 'hand-label';

Â  Â  Â  Â  Â  Â  handTitle.textContent = `Hand ${activeHandIndex + 1}: `;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  const scoreDisplay = document.createElement('div');

Â  Â  Â  Â  Â  Â  scoreDisplay.className = 'player-score text-lg';

Â  Â  Â  Â  Â  Â  scoreDisplay.textContent = `Score: ${hand.score}`;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  const cardsContainer = document.createElement('div');

Â  Â  Â  Â  Â  Â  cardsContainer.className = 'player-cards flex space-x-2 mt-2 min-h-[100px]';

Â  Â  Â  Â  Â  Â  cardsContainer.id = `cards-${hand.id}`;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  hand.cards.forEach(card => {

Â  Â  Â  Â  Â  Â  Â  Â  const cardElement = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  cardElement.className = 'card';

Â  Â  Â  Â  Â  Â  Â  Â  cardElement.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-face">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="value">${card.value}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="suit">${card.suit}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-back"></div>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.appendChild(cardElement);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  handContainer.appendChild(handTitle);

Â  Â  Â  Â  Â  Â  handContainer.appendChild(scoreDisplay);

Â  Â  Â  Â  Â  Â  handContainer.appendChild(cardsContainer);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  playerHandsDisplay.appendChild(handContainer);

Â  Â  Â  Â  Â  Â  hand.element = handContainer;

Â  Â  Â  Â  Â  Â  hand.scoreElement = scoreDisplay;

Â  Â  Â  Â  Â  Â  hand.cardsContainer = cardsContainer;

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  async function dealCardToPlayer(hand) {

Â  Â  Â  Â  Â  Â  if (deck.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Deck is empty, cannot deal card.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const card = deck.pop();

Â  Â  Â  Â  Â  Â  hand.cards.push(card);

Â  Â  Â  Â  Â  Â  const cardElement = document.createElement('div');

Â  Â  Â  Â  Â  Â  cardElement.className = 'card dealing';

Â  Â  Â  Â  Â  Â  cardElement.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-face">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="value">${card.value}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="suit">${card.suit}</div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-back"></div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  hand.cardsContainer.appendChild(cardElement);

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â  cardElement.classList.remove('dealing');

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  async function dealCardToDealer(faceUp) {

Â  Â  Â  Â  Â  Â  if (deck.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Deck is empty, cannot deal card.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const card = deck.pop();

Â  Â  Â  Â  Â  Â  dealerHand.cards.push(card);

Â  Â  Â  Â  Â  Â  const cardElement = document.createElement('div');

Â  Â  Â  Â  Â  Â  cardElement.className = 'card dealing';

Â  Â  Â  Â  Â  Â  cardElement.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-face">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="value">${card.value}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="suit">${card.suit}</div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-back"></div>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  dealerCardsEl.appendChild(cardElement);

Â  Â  Â  Â  Â  Â  await sleep(300);

Â  Â  Â  Â  Â  Â  cardElement.classList.remove('dealing');

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // If dealer's first card is an Ace, prompt for insurance

Â  Â  Â  Â  Â  Â  if (faceUp && card.value === 'A') {

Â  Â  Â  Â  Â  Â  Â  Â  // Implement insurance logic here if desired

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  function toggleControls(showGameControls) {

Â  Â  Â  Â  Â  Â  if (showGameControls) {

Â  Â  Â  Â  Â  Â  Â  Â  gameControls.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  bettingControls.classList.add('hidden');

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  gameControls.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  bettingControls.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  // --- Event Listeners Setup ---

Â  Â  Â  Â  function setupEventListeners() {

Â  Â  Â  Â  Â  Â  // Game Buttons

Â  Â  Â  Â  Â  Â  const placeBetBtn = document.getElementById('place-bet-btn');

Â  Â  Â  Â  Â  Â  const hitBtn = document.getElementById('hit-btn');

Â  Â  Â  Â  Â  Â  const standBtn = document.getElementById('stand-btn');

Â  Â  Â  Â  Â  Â  const playAgainBtn = document.getElementById('play-again-btn');

Â  Â  Â  Â  Â  Â  const returnMenuBtn = document.getElementById('return-menu-btn');

Â  Â  Â  Â  Â  Â  splitButton = document.getElementById('split-btn');

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Main Menu Buttons

Â  Â  Â  Â  Â  Â  const playBtn = document.getElementById('play-btn');

Â  Â  Â  Â  Â  Â  const logoutBtn = document.getElementById('logout-btn');

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Initialize play button

Â  Â  Â  Â  Â  Â  if (playBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  playBtn.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainMenu.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameCanvas.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Initialize logout button

Â  Â  Â  Â  Â  Â  if (logoutBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  logoutBtn.addEventListener('click', async () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Sign out from Firebase auth if applicable

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (auth && !currentUser?.isCustomAuth && !currentUser?.isLocalGuest) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Reset user session state

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayerName = "Guest";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerChips = 100;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showAuthForms();

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Game controls

Â  Â  Â  Â  Â  Â  if (placeBetBtn) placeBetBtn.addEventListener('click', placeBet);

Â  Â  Â  Â  Â  Â  if (hitBtn) hitBtn.addEventListener('click', hit);

Â  Â  Â  Â  Â  Â  if (standBtn) standBtn.addEventListener('click', stand);

Â  Â  Â  Â  Â  Â  if (playAgainBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  playAgainBtn.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetGameStateToDefault();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleControls(false); // Show betting controls

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (gameResultScreen) gameResultScreen.classList.remove('active');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sideBetResultsEl) sideBetResultsEl.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Return to main menu button

Â  Â  Â  Â  Â  Â  if (returnMenuBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  returnMenuBtn.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetGameStateToDefault();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameCanvas.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainMenu.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (gameResultScreen) gameResultScreen.classList.remove('active');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Split button

Â  Â  Â  Â  Â  Â  if (splitButton) {

Â  Â  Â  Â  Â  Â  Â  Â  splitButton.addEventListener('click', handleSplit);

Â  Â  Â  Â  Â  Â  Â  Â  splitButton.disabled = true; // Initially disabled

Â  Â  Â  Â  Â  Â  Â  Â  splitButton.classList.add('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  function placeBet() {

Â  Â  Â  Â  Â  Â  // Get bet amount from inputs

Â  Â  Â  Â  Â  Â  const betInput = document.getElementById('bet-amount');

Â  Â  Â  Â  Â  Â  const mainBet = parseInt(betInput.value) || 0;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Get side bet amounts if they exist

Â  Â  Â  Â  Â  Â  const ppBetInput = document.getElementById('perfect-pairs-bet');

Â  Â  Â  Â  Â  Â  const bet21Plus3Input = document.getElementById('twenty-one-plus-three-bet');

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  perfectPairsBetAmount = ppBetInput ? (parseInt(ppBetInput.value) || 0) : 0;

Â  Â  Â  Â  Â  Â  twentyOnePlusThreeBetAmount = bet21Plus3Input ? (parseInt(bet21Plus3Input.value) || 0) : 0;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Calculate total bet

Â  Â  Â  Â  Â  Â  const totalBet = mainBet + perfectPairsBetAmount + twentyOnePlusThreeBetAmount;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Validate bets

Â  Â  Â  Â  Â  Â  if (mainBet <= 0) {

Â  Â  Â  Â  Â  Â  Â  Â  alert("Please enter a valid main bet amount.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  if (perfectPairsBetAmount < 0 || twentyOnePlusThreeBetAmount < 0) {

Â  Â  Â  Â  Â  Â  Â  Â  alert("Side bets cannot be negative.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  if (totalBet > playerChips) {

Â  Â  Â  Â  Â  Â  Â  Â  alert("You don't have enough chips for this bet.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Update game state

Â  Â  Â  Â  Â  Â  currentBet = mainBet;

Â  Â  Â  Â  Â  Â  playerChips -= totalBet;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Update UI

Â  Â  Â  Â  Â  Â  const chipsDisplay = document.getElementById('player-chips');

Â  Â  Â  Â  Â  Â  if (chipsDisplay) chipsDisplay.textContent = playerChips;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  const currentBetDisplay = document.getElementById('current-bet');

Â  Â  Â  Â  Â  Â  if (currentBetDisplay) currentBetDisplay.textContent = currentBet;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  if (currentPPBetDisplay) currentPPBetDisplay.textContent = perfectPairsBetAmount;

Â  Â  Â  Â  Â  Â  if (current21Plus3BetDisplay) current21Plus3BetDisplay.textContent = twentyOnePlusThreeBetAmount;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  // Start the game

Â  Â  Â  Â  Â  Â  startNewHand();

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  // Initialize game

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  console.log("DOM content loaded");

Â  Â  Â  Â  Â  Â  initializeFirebase();

Â  Â  Â  Â  Â  Â  setupEventListeners(); // Setup all game interaction listeners

Â  Â  Â  Â  Â  Â  resetGameStateToDefault(); // Ensure clean state on load

Â  Â  Â  Â  Â  Â  toggleControls(false); // Show betting controls initially

Â  Â  Â  Â  });

Â  Â  </script>

</body>

</html>